

<div class="auth-container">
  <div class="auth-card">
    <div class="logo-container">
      <img src="assets/logoSorteo.jpg" alt="Logo Sorteo" class="logo" routerLink="/home" />
    </div>

    <!-- FORMULARIO DE LOGIN -->
    <form [formGroup]="loginForm" (ngSubmit)="onLogin()" *ngIf="isLogin">
      <h1>Inicia Sesión</h1>

      <input type="email" pInputText placeholder="Correo" formControlName="email" />

      <p-password
        placeholder="Contraseña"
        formControlName="password"
        [toggleMask]="true"
        [feedback]="false"
      />

      <a class="forgot-password" (click)="showRecoveryDialog()">¿Olvidaste tu contraseña?</a>

      <button pButton type="submit" label="Ingresar" class="p-button-success w-full mt-2"></button>
      <p class="toggle-text">¿No tienes una cuenta? <a (click)="toggle()">Regístrate</a></p>
    </form>

    <!-- FORMULARIO DE REGISTRO -->
    <form [formGroup]="registerForm" (ngSubmit)="onSignup()" *ngIf="!isLogin">
      <h1>Regístrate</h1>

      <input type="text" pInputText placeholder="Nombre" formControlName="name" />
      <input type="email" pInputText placeholder="Correo" formControlName="email" />

      <p-password
        placeholder="Contraseña"
        formControlName="password"
        [toggleMask]="true"
        weakLabel="Débil"
        mediumLabel="Medio"
        strongLabel="Fuerte"
        promptLabel="Ingresa tu contraseña"
      />

      <p-password
        placeholder="Confirmar Contraseña"
        formControlName="confirmarPassword"
        [toggleMask]="true"
        [feedback]="false"
      />

      <p-inputMask
        mask="+54 9 99 9999-9999"
        placeholder="+54 9 -- -----"
        formControlName="telefono"
        [autoClear]="false"
        slotChar="_"
      ></p-inputMask>

      <button pButton type="submit" label="Registrarse" class="p-button-success w-full"></button>
      <p class="toggle-text">¿Ya tienes una cuenta? <a (click)="toggle()">Iniciar sesión</a></p>
    </form>
  </div>
</div>


<p-dialog
  header="Recuperar Contraseña"
  [(visible)]="displayRecoveryDialog"
  [modal]="true"
  [style]="{ width: '90%', maxWidth: '500px' }"
  [draggable]="false"
  [resizable]="false"
>
  <form [formGroup]="recoveryForm" (ngSubmit)="onRecuperar()">
    <div class="p-fluid">
      <div class="field">
        <label for="emailRecovery" class="block font-bold mb-2">Correo Electrónico</label>
        <input
          id="emailRecovery"
          type="email"
          pInputText
          formControlName="email"
          placeholder="tu@email.com"
          class="w-full"
        />
        <small
          class="text-red-500"
          *ngIf="recoveryForm.get('email')?.invalid && (recoveryForm.get('email')?.dirty || recoveryForm.get('email')?.touched)"
        >
          Debes ingresar un correo electrónico válido.
        </small>
      </div>

      <p class="text-sm text-gray-600 mt-2">
        Se enviará un código de recuperación a tu correo electrónico.
      </p>
    </div>

    <div class="flex justify-content-end gap-2 mt-4">
      <button
        pButton
        type="button"
        label="Cancelar"
        icon="pi pi-times"
        class="p-button-text"
        (click)="hideRecoveryDialog()"
      ></button>
      <button
        pButton
        type="submit"
        label="Enviar Código"
        icon="pi pi-send"
        class="p-button-primary"
        [disabled]="!recoveryForm.valid"
      ></button>
    </div>
  </form>
</p-dialog>

<!-- 🔥 DIÁLOGO 2: CAMBIAR CONTRASEÑA CON CÓDIGO -->
<p-dialog
  header="Cambiar Contraseña"
  [(visible)]="displayChangePasswordDialog"
  [modal]="true"
  [style]="{ width: '90%', maxWidth: '500px' }"
  [draggable]="false"
  [resizable]="false"
>
  <form [formGroup]="changePasswordForm" (ngSubmit)="onChangePassword()">
    <div class="p-fluid">

      <!-- Email (readonly) -->
      <div class="field">
        <label for="emailChange" class="block font-bold mb-2">Correo Electrónico</label>
        <input
          id="emailChange"
          type="email"
          pInputText
          formControlName="email"
          class="w-full"
          readonly
        />
      </div>

      <!-- Código de recuperación -->
      <div class="field">
        <label for="codigo" class="block font-bold mb-2">Código de Recuperación</label>
        <input
          id="codigo"
          type="text"
          pInputText
          formControlName="codigo"
          placeholder="Ingresa el código recibido por correo"
          class="w-full"
        />
        <small
          class="text-red-500"
          *ngIf="changePasswordForm.get('codigo')?.invalid && (changePasswordForm.get('codigo')?.dirty || changePasswordForm.get('codigo')?.touched)"
        >
          El código es requerido.
        </small>
      </div>

      <!-- Nueva contraseña -->
      <div class="field">
        <label for="nuevaPassword" class="block font-bold mb-2">Nueva Contraseña</label>
        <p-password
          id="nuevaPassword"
          formControlName="nuevaPassword"
          placeholder="Mínimo 6 caracteres"
          [toggleMask]="true"
          [feedback]="true"
          weakLabel="Débil"
          mediumLabel="Medio"
          strongLabel="Fuerte"
          class="w-full"
        />
        <small
          class="text-red-500"
          *ngIf="changePasswordForm.get('nuevaPassword')?.invalid && (changePasswordForm.get('nuevaPassword')?.dirty || changePasswordForm.get('nuevaPassword')?.touched)"
        >
          La contraseña debe tener al menos 6 caracteres.
        </small>
      </div>

      <!-- Confirmar nueva contraseña -->
      <div class="field">
        <label for="confirmarNuevaPassword" class="block font-bold mb-2">Confirmar Nueva Contraseña</label>
        <p-password
          id="confirmarNuevaPassword"
          formControlName="confirmarNuevaPassword"
          placeholder="Confirma tu contraseña"
          [toggleMask]="true"
          [feedback]="false"
          class="w-full"
        />
        <small
          class="text-red-500"
          *ngIf="changePasswordForm.get('confirmarNuevaPassword')?.invalid && (changePasswordForm.get('confirmarNuevaPassword')?.dirty || changePasswordForm.get('confirmarNuevaPassword')?.touched)"
        >
          Debes confirmar la contraseña.
        </small>
      </div>

      <p class="text-sm text-gray-600 mt-2">
        <i class="pi pi-info-circle"></i> Revisa tu correo para obtener el código de recuperación.
      </p>
    </div>

    <div class="flex justify-content-end gap-2 mt-4">
      <button
        pButton
        type="button"
        label="Cancelar"
        icon="pi pi-times"
        class="p-button-text"
        (click)="hideChangePasswordDialog()"
      ></button>
      <button
        pButton
        type="submit"
        label="Cambiar Contraseña"
        icon="pi pi-check"
        class="p-button-success"
        [disabled]="!changePasswordForm.valid"
      ></button>
    </div>
  </form>
</p-dialog>
